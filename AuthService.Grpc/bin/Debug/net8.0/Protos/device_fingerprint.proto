syntax = "proto3";

option csharp_namespace = "AuthService.Grpc.Protos";

import "google/protobuf/timestamp.proto";

package devicefingerprint;

service DeviceFingerprintService {
  rpc RegisterDevice (RegisterDeviceRequest) returns (RegisterDeviceResponse);
  rpc ValidateFingerprint (ValidateFingerprintRequest) returns (ValidateFingerprintResponse);
  rpc TrustDevice (TrustDeviceRequest) returns (TrustDeviceResponse);
  rpc GetUserDevices (GetUserDevicesRequest) returns (GetUserDevicesResponse);
  rpc CheckDeviceTrust (CheckDeviceTrustRequest) returns (CheckDeviceTrustResponse);
}

message DeviceInfo {
  string device_id = 1;
  string device_name = 2;
  string device_type = 3;
  string operating_system = 4;
  string browser = 5;
  string user_agent = 6;
  string ip_address = 7;
  string screen_resolution = 8;
  string time_zone = 9;
  string language = 10;
  bool has_touch_screen = 11;
}

message RegisterDeviceRequest {
  string user_id = 1;
  DeviceInfo device_info = 2;
}

message RegisterDeviceResponse {
  bool success = 1;
  string fingerprint_id = 2;
  string fingerprint_hash = 3;
  string message = 4;
}

message ValidateFingerprintRequest {
  string user_id = 1;
  string fingerprint_hash = 2;
}

message ValidateFingerprintResponse {
  bool is_valid = 1;
  bool is_trusted = 2;
  google.protobuf.Timestamp last_used_at = 3;
}

message TrustDeviceRequest {
  string user_id = 1;
  string fingerprint_id = 2;
  bool trust = 3;
}

message TrustDeviceResponse {
  bool success = 1;
  string message = 2;
}

message GetUserDevicesRequest {
  string user_id = 1;
}

message GetUserDevicesResponse {
  repeated UserDevice devices = 1;
}

message UserDevice {
  string fingerprint_id = 1;
  string device_name = 2;
  string device_type = 3;
  string operating_system = 4;
  string browser = 5;
  bool is_trusted = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp last_used_at = 8;
}

message CheckDeviceTrustRequest {
  string user_id = 1;
  string device_fingerprint = 2;
}

message CheckDeviceTrustResponse {
  bool is_trusted = 1;
  bool requires_mfa = 2;
  string trust_level = 3;
}